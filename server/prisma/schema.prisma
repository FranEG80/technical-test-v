generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "sqlite" // "postgresql"
  url      = env("DATABASE_URL")
}


model User {
  id        String       @id @default(cuid())
  email     String       @unique
  name      String?
  notebooks UserNotebook[]
  owned     Notebook[]  @relation("NotebookOwner")
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
}

model Notebook {
  id        String       @id @default(cuid())
  title     String
  sheets    Sheet[]
  users     UserNotebook[]
  ownerId   String?
  owner     User?      @relation("NotebookOwner", fields: [ownerId], references: [id], onDelete: SetNull)
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  @@index([ownerId])
}

model Sheet {
  id         String   @id @default(cuid())
  title      String
  storeJson  Json
  notebook   Notebook @relation(fields: [notebookId], references: [id], onDelete: Cascade)
  notebookId String
  order      Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model UserNotebook {
  userId     String
  notebookId String
  role       UserRole @default(editor)

  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  notebook Notebook @relation(fields: [notebookId], references: [id], onDelete: Cascade)

  @@id([userId, notebookId])
}

enum UserRole {
  owner
  editor
  viewer
}